{"ast":null,"code":"var _jsxFileName = \"/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/card/my-auction-card.js\";\nimport React from 'react';\nimport 'antd/dist/antd.css';\nimport { Tag, Image, Layout, Button, Descriptions, PageHeader, Modal, InputNumber, message } from 'antd';\nimport contractInstance from '../../utils/config';\nimport web3 from '../../utils/InitWeb3';\nimport { FileProtectOutlined } from '@ant-design/icons';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst {\n  Content\n} = Layout;\nexport default class MyAuctionCard extends React.Component {\n  constructor(props) {\n    var _this;\n\n    super(props);\n    _this = this;\n\n    this.renderContent = function () {\n      let column = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 2;\n      return /*#__PURE__*/_jsxDEV(Descriptions, {\n        size: \"small\",\n        column: column,\n        children: [/*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u540D\\u79F0\",\n          children: _this.state.NFT.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u63CF\\u8FF0\",\n          children: _this.state.NFT.description\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u8D77\\u62CD\\u4EF7\\u683C\",\n          children: _this.state.startPrice\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u6536\\u85CF\\u54C1\\u6240\\u6709\\u8005\",\n          children: _this.state.auctionowner\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u4EF7\\u683C\",\n          children: _this.state.NFT.currentprice\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(Descriptions.Item, {\n          label: \"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u51FA\\u4EF7\\u8005\",\n          children: _this.state.NFT.currentowner\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 13\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 9\n      }, _this);\n    };\n\n    this.state = {\n      NFT: props.NFT,\n      isConnected: false,\n      address: \"\",\n      buttonDisable: false,\n      tagColor: \"red\",\n      NFTState: \"正在拍卖\",\n      startPrice: 0,\n      modalVisible: true,\n      auctionowner: \"\"\n    };\n    this.renderContent = this.renderContent.bind(this);\n    this.approve = this.approve.bind(this);\n  }\n\n  async componentDidMount() {\n    let accounts = await web3.eth.getAccounts();\n\n    if (accounts.length == 0) {\n      this.setState({\n        isConnected: false\n      });\n    } else {\n      this.setState({\n        isConnected: true,\n        address: accounts[0]\n      });\n      let NFT = this.state.NFT; //设定拍卖状态\n\n      if (NFT.onsale == true) {\n        this.setState({\n          NFTState: \"拍卖中\",\n          tagColor: \"red\",\n          buttonDisable: true\n        });\n      } else if (NFT.setaside == true) {\n        this.setState({\n          NFTState: \"拍卖结束（等待申领）\",\n          tagColor: \"green\",\n          buttonDisable: false\n        });\n      } //得到拍卖信息\n\n\n      let ret = await contractInstance.methods.bidprices(NFT.id, 0).call();\n      console.log(ret);\n      this.setState({\n        startPrice: ret\n      });\n      ret = await contractInstance.methods.ownerOf(NFT.id).call();\n      this.setState({\n        auctionowner: ret\n      });\n    }\n  }\n\n  //卖方许可函数\n  async approve() {\n    let NFT = this.state.NFT;\n    console.log(NFT.id);\n\n    try {\n      let tx = await contractInstance.methods.sellerApprove(Number(NFT.id)).send({\n        from: this.state.address,\n        value: web3.utils.toWei('0.0000000001', 'ether')\n      });\n      message.success('卖方确认交易成功');\n      this.setstate({\n        buttonDisable: true\n      });\n      window.location.reload();\n    } catch (e) {\n      console.log(e);\n      window.location.reload();\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        boxShadow: \"2px 2px 1px 2px #888\",\n        margin: \"5px\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(PageHeader, {\n        title: this.state.NFT.id,\n        tags: /*#__PURE__*/_jsxDEV(Tag, {\n          color: this.state.tagColor,\n          children: this.state.NFTState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 27\n        }, this),\n        extra: [/*#__PURE__*/_jsxDEV(Button, {\n          type: \"primary\",\n          disabled: this.state.buttonDisable,\n          onClick: this.approve,\n          children: \"\\u51FA\\u552E\\u8BB8\\u53EF\"\n        }, \"1\", false, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 25\n        }, this)]\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Image, {\n        width: 200,\n        height: 200,\n        src: this.state.NFT.uri\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(Content, {\n        children: this.renderContent()\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/card/my-auction-card.js"],"names":["React","Tag","Image","Layout","Button","Descriptions","PageHeader","Modal","InputNumber","message","contractInstance","web3","FileProtectOutlined","Content","MyAuctionCard","Component","constructor","props","renderContent","column","state","NFT","name","description","startPrice","auctionowner","currentprice","currentowner","isConnected","address","buttonDisable","tagColor","NFTState","modalVisible","bind","approve","componentDidMount","accounts","eth","getAccounts","length","setState","onsale","setaside","ret","methods","bidprices","id","call","console","log","ownerOf","tx","sellerApprove","Number","send","from","value","utils","toWei","success","setstate","window","location","reload","e","render","boxShadow","margin","uri"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport { Tag, Image, Layout, Button, Descriptions, PageHeader, Modal, InputNumber, message } from 'antd';\r\nimport contractInstance from '../../utils/config';\r\nimport web3 from '../../utils/InitWeb3';\r\nimport { FileProtectOutlined } from '@ant-design/icons';\r\n\r\nconst {Content} = Layout;\r\n\r\nexport default class MyAuctionCard extends React.Component{\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = ({\r\n            NFT: props.NFT,\r\n            isConnected: false,\r\n            address: \"\",\r\n            buttonDisable: false,\r\n            tagColor: \"red\",\r\n            NFTState: \"正在拍卖\",\r\n            startPrice: 0,\r\n            modalVisible: true,\r\n            auctionowner: \"\",\r\n        })\r\n\r\n        this.renderContent = this.renderContent.bind(this);\r\n        this.approve = this.approve.bind(this);\r\n    }\r\n\r\n    async componentDidMount(){\r\n\r\n        let accounts = await web3.eth.getAccounts()\r\n        if (accounts.length == 0) {\r\n            this.setState({\r\n                isConnected: false\r\n            })\r\n        }\r\n        else {\r\n            this.setState({\r\n                isConnected: true,\r\n                address: accounts[0]\r\n            })\r\n\r\n            let NFT = this.state.NFT;\r\n            \r\n            //设定拍卖状态\r\n            if(NFT.onsale == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖中\",\r\n                    tagColor: \"red\",\r\n                    buttonDisable: true,\r\n                })\r\n            }\r\n            else if(NFT.setaside == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖结束（等待申领）\",\r\n                    tagColor: \"green\",\r\n                    buttonDisable: false,\r\n                })\r\n            }\r\n\r\n            //得到拍卖信息\r\n            let ret = await contractInstance.methods.bidprices(NFT.id, 0).call();\r\n            console.log(ret);\r\n            this.setState({\r\n                startPrice: ret,\r\n            })\r\n\r\n            ret = await contractInstance.methods.ownerOf(NFT.id).call();\r\n            this.setState({\r\n                auctionowner: ret,\r\n            })\r\n        }\r\n    }\r\n    \r\n    renderContent = (column = 2) =>(\r\n        <Descriptions size=\"small\" column={column}>\r\n            <Descriptions.Item label=\"名称\">{this.state.NFT.name}</Descriptions.Item>\r\n            <Descriptions.Item label=\"描述\">{this.state.NFT.description}</Descriptions.Item>\r\n            <Descriptions.Item label=\"起拍价格\">{this.state.startPrice}</Descriptions.Item>\r\n            <Descriptions.Item label=\"收藏品所有者\">{this.state.auctionowner}</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高价格\">{this.state.NFT.currentprice}</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高出价者\">{this.state.NFT.currentowner}</Descriptions.Item>\r\n        </Descriptions>\r\n    );\r\n\r\n    //卖方许可函数\r\n    async approve(){\r\n        let NFT = this.state.NFT;\r\n        console.log(NFT.id);\r\n        try{\r\n            let tx = await contractInstance.methods.sellerApprove(Number(NFT.id )).send({\r\n                from: this.state.address,\r\n                value: web3.utils.toWei('0.0000000001', 'ether'),\r\n            })\r\n            message.success('卖方确认交易成功');\r\n            this.setstate({\r\n                buttonDisable: true,\r\n            });\r\n            window.location.reload();\r\n        }\r\n        catch(e){\r\n            console.log(e);\r\n            window.location.reload();\r\n        }\r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <div style={{boxShadow: \"2px 2px 1px 2px #888\", margin: \"5px\"}}>\r\n                <PageHeader\r\n                    title= {this.state.NFT.id}\r\n                    tags={<Tag color={this.state.tagColor}>{this.state.NFTState}</Tag>}\r\n                    extra={[\r\n                        <Button key=\"1\" type=\"primary\" disabled={this.state.buttonDisable} onClick={this.approve}>\r\n                            出售许可\r\n                        </Button>\r\n                    ]}>\r\n                </PageHeader>\r\n                <Image width={200} height={200} src={this.state.NFT.uri} />\r\n                <Content>{this.renderContent()}</Content>\r\n            </div>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}