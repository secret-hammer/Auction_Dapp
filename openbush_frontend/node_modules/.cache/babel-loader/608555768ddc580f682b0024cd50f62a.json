{"ast":null,"code":"import _regeneratorRuntime from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'antd/dist/antd.css';import{Tag,Image,Form,List,Typography,Layout,Button,Descriptions,PageHeader,Modal,InputNumber,message}from'antd';import contractInstance from'../../utils/config';import web3 from'../../utils/InitWeb3';import{FileProtectOutlined}from'@ant-design/icons';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Content=Layout.Content;var MyMarketCard=/*#__PURE__*/function(_React$Component){_inherits(MyMarketCard,_React$Component);var _super=_createSuper(MyMarketCard);function MyMarketCard(props){var _this;_classCallCheck(this,MyMarketCard);_this=_super.call(this,props);_this.formRef=/*#__PURE__*/React.createRef();_this.renderContent=function(){var column=arguments.length>0&&arguments[0]!==undefined?arguments[0]:2;return/*#__PURE__*/_jsxs(Descriptions,{size:\"small\",column:column,bordered:true,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u540D\\u79F0\",children:_this.state.NFT.name}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u63CF\\u8FF0\",children:_this.state.NFT.description}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"\\u8D77\\u62CD\\u4EF7\\u683C\",children:[web3.utils.fromWei(_this.state.startPrice.toString(),\"ether\"),\" ether\"]}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u4EF7\\u683C\",children:[web3.utils.fromWei(_this.state.NFT.currentprice.toString(),\"ether\"),\"  ether\"]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u6536\\u85CF\\u54C1\\u6240\\u6709\\u8005\",children:_this.state.auctionowner}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u51FA\\u4EF7\\u8005\",children:_this.state.NFT.currentowner})]});};_this.renderOwners=function(){return/*#__PURE__*/_jsx(List,{header:/*#__PURE__*/_jsx(\"div\",{children:\"\\u6D41\\u8F6C\\u4FE1\\u606F\"}),bordered:true,dataSource:_this.state.owners,renderItem:function renderItem(item){return/*#__PURE__*/_jsxs(List.Item,{children:[/*#__PURE__*/_jsx(Typography.Text,{mark:true,children:\"[ADDRESS]\"}),\" \",item]});}});};_this.state={NFT:props.NFT,isConnected:false,address:\"\",bidButtonDisable:false,tagColor:\"red\",NFTState:\"正在拍卖\",startPrice:0,auctionowner:\"\",modalVisible:false,owners:[]};_this.renderContent=_this.renderContent.bind(_assertThisInitialized(_this));return _this;}_createClass(MyMarketCard,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var accounts,NFT,ret,owners,_ret,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return web3.eth.getAccounts();case 2:accounts=_context.sent;if(!(accounts.length==0)){_context.next=7;break;}this.setState({isConnected:false});_context.next=37;break;case 7:this.setState({isConnected:true,address:accounts[0]});NFT=this.state.NFT;if(NFT.onsale==true){this.setState({NFTState:\"拍卖中\",tagColor:\"red\",bidButtonDisable:false});}else if(NFT.setaside==true){this.setState({NFTState:\"拍卖结束（等待申领）\",tagColor:\"green\",bidButtonDisable:true});}//得到拍卖信息\n_context.next=12;return contractInstance.methods.bidprices(NFT.id,0).call();case 12:ret=_context.sent;console.log(ret);this.setState({startPrice:ret});_context.next=17;return contractInstance.methods.ownerOf(NFT.id).call();case 17:ret=_context.sent;this.setState({auctionowner:ret});//获取流转信息\n_context.prev=19;owners=[];i=0;case 22:if(!(i<NFT.ownerNum)){_context.next=30;break;}_context.next=25;return contractInstance.methods.owners(NFT.id,i).call();case 25:_ret=_context.sent;owners.push(_ret);case 27:i++;_context.next=22;break;case 30:console.log(owners);this.setState({owners:owners});_context.next=37;break;case 34:_context.prev=34;_context.t0=_context[\"catch\"](19);console.log(_context.t0);case 37:case\"end\":return _context.stop();}}},_callee,this,[[19,34]]);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"bid\",value://竞拍函数\nfunction(){var _bid=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var NFT,values,tx;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:NFT=this.state.NFT;values=this.formRef.current.getFieldValue();if(!(NFT.currentowner!=this.state.address)){_context2.next=17;break;}_context2.prev=3;_context2.next=6;return contractInstance.methods.bid(Number(NFT.id),web3.utils.toWei(values.price.toString(),\"ether\")).send({from:this.state.address,value:web3.utils.toWei('0.00000001','ether')});case 6:tx=_context2.sent;message.success('竞价成功');window.location.reload();_context2.next=15;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](3);console.log(_context2.t0);message.error(\"竞价失败\");case 15:_context2.next=18;break;case 17:message.info(\"您已经是出价最高的人了\");case 18:case\"end\":return _context2.stop();}}},_callee2,this,[[3,11]]);}));function bid(){return _bid.apply(this,arguments);}return bid;}()},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{style:{boxShadow:\"2px 2px 1px 2px #888\",margin:\"5px\"},children:[/*#__PURE__*/_jsx(PageHeader,{title:this.state.NFT.id,tags:/*#__PURE__*/_jsx(Tag,{color:this.state.tagColor,children:this.state.NFTState}),extra:[/*#__PURE__*/_jsx(Button,{type:\"primary\",disabled:this.state.bidButtonDisable,onClick:function onClick(){return _this2.setState({modalVisible:true});},children:\"\\u7ADE\\u4EF7\"},\"1\")]}),/*#__PURE__*/_jsx(Image,{width:200,height:200,src:this.state.NFT.uri}),/*#__PURE__*/_jsx(Content,{children:this.renderContent()}),/*#__PURE__*/_jsx(Content,{children:this.renderOwners()}),/*#__PURE__*/_jsx(Modal,{visible:this.state.modalVisible,title:\"\\u7ADE\\u4EF7\",okText:\"\\u63D0\\u4EA4\",cancelText:\"\\u53D6\\u6D88\",onCancel:function onCancel(){_this2.setState({modalVisible:false});},onOk:function onOk(){_this2.bid();_this2.formRef.current.resetFields();},children:/*#__PURE__*/_jsx(Form,{ref:this.formRef,layout:\"vertical\",name:\"bidForm\",initialValues:{modifier:'public'},children:/*#__PURE__*/_jsx(Form.Item,{name:\"price\",label:\"\\u51FA\\u4EF7\",rules:[{required:true,message:'请填写您的出价'}],children:/*#__PURE__*/_jsx(InputNumber,{min:1,max:10000000000})})})})]});}}]);return MyMarketCard;}(React.Component);export default MyMarketCard;","map":{"version":3,"sources":["/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/card/market-card.js"],"names":["React","Tag","Image","Form","List","Typography","Layout","Button","Descriptions","PageHeader","Modal","InputNumber","message","contractInstance","web3","FileProtectOutlined","Content","MyMarketCard","props","formRef","createRef","renderContent","column","state","NFT","name","description","utils","fromWei","startPrice","toString","currentprice","auctionowner","currentowner","renderOwners","owners","item","isConnected","address","bidButtonDisable","tagColor","NFTState","modalVisible","bind","eth","getAccounts","accounts","length","setState","onsale","setaside","methods","bidprices","id","call","ret","console","log","ownerOf","i","ownerNum","push","values","current","getFieldValue","bid","Number","toWei","price","send","from","value","tx","success","window","location","reload","error","info","boxShadow","margin","uri","resetFields","modifier","required","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport { Tag, Image, Form, List, Typography, Layout, Button, Descriptions, PageHeader, Modal, InputNumber, message } from 'antd';\r\nimport contractInstance from '../../utils/config';\r\nimport web3 from '../../utils/InitWeb3';\r\nimport { FileProtectOutlined } from '@ant-design/icons';\r\n\r\nconst {Content} = Layout;\r\n\r\nclass MyMarketCard extends React.Component{\r\n\r\n    formRef = React.createRef();\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = ({\r\n            NFT: props.NFT,\r\n            isConnected: false,\r\n            address: \"\",\r\n            bidButtonDisable: false,\r\n            tagColor: \"red\",\r\n            NFTState: \"正在拍卖\",\r\n            startPrice: 0,\r\n            auctionowner: \"\",\r\n            modalVisible: false,\r\n            owners: [],\r\n        })\r\n\r\n        this.renderContent = this.renderContent.bind(this);\r\n\r\n    }\r\n\r\n    async componentDidMount(){\r\n\r\n        let accounts = await web3.eth.getAccounts()\r\n        if (accounts.length == 0) {\r\n            this.setState({\r\n                isConnected: false\r\n            })\r\n        }\r\n        else {\r\n            this.setState({\r\n                isConnected: true,\r\n                address: accounts[0]\r\n            })\r\n\r\n            let NFT = this.state.NFT;\r\n\r\n            if(NFT.onsale == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖中\",\r\n                    tagColor: \"red\",\r\n                    bidButtonDisable: false,\r\n                })\r\n            }\r\n\r\n            else if(NFT.setaside == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖结束（等待申领）\",\r\n                    tagColor: \"green\",\r\n                    bidButtonDisable: true,\r\n                })\r\n            }\r\n\r\n            \r\n            //得到拍卖信息\r\n            let ret = await contractInstance.methods.bidprices(NFT.id, 0).call();\r\n            console.log(ret);\r\n            this.setState({\r\n                startPrice: ret,\r\n            })\r\n\r\n            ret = await contractInstance.methods.ownerOf(NFT.id).call();\r\n            this.setState({\r\n                auctionowner: ret,\r\n            })\r\n\r\n            //获取流转信息\r\n            try{\r\n                let owners = [], ret;\r\n                for(let i = 0; i < NFT.ownerNum; i++){\r\n                    ret = await contractInstance.methods.owners(NFT.id, i).call();\r\n                    owners.push(ret);\r\n                }\r\n                console.log(owners);\r\n                this.setState({\r\n                    owners: owners,\r\n                })\r\n            }\r\n            catch(e){\r\n                console.log(e);\r\n            }\r\n        }\r\n    }\r\n    \r\n    renderContent = (column = 2) =>(\r\n        <Descriptions size=\"small\" column={column} bordered>\r\n            <Descriptions.Item label=\"名称\">{this.state.NFT.name}</Descriptions.Item>\r\n            <Descriptions.Item label=\"描述\">{this.state.NFT.description}</Descriptions.Item>\r\n            <Descriptions.Item label=\"起拍价格\">{web3.utils.fromWei((this.state.startPrice).toString(), \"ether\")} ether</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高价格\">{web3.utils.fromWei((this.state.NFT.currentprice).toString(), \"ether\")}  ether</Descriptions.Item>\r\n            <Descriptions.Item label=\"收藏品所有者\">{this.state.auctionowner}</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高出价者\">{this.state.NFT.currentowner}</Descriptions.Item>\r\n        </Descriptions>\r\n    );\r\n\r\n    renderOwners = () =>(\r\n        <List\r\n        header={<div>流转信息</div>}\r\n        bordered\r\n        dataSource={this.state.owners}\r\n        renderItem={item => (\r\n            <List.Item>\r\n                <Typography.Text mark>[ADDRESS]</Typography.Text> {item}\r\n            </List.Item>\r\n      )}\r\n        />\r\n    );\r\n\r\n    //竞拍函数\r\n    async bid(){\r\n        let NFT = this.state.NFT;\r\n        let values = this.formRef.current.getFieldValue();\r\n        if(NFT.currentowner != this.state.address){\r\n            try{\r\n                let tx = await contractInstance.methods.bid(Number(NFT.id), web3.utils.toWei((values.price).toString(), \"ether\")).send({\r\n                    from: this.state.address,\r\n                    value: web3.utils.toWei('0.00000001', 'ether'),\r\n                });\r\n                message.success('竞价成功');\r\n                window.location.reload();\r\n            }\r\n            catch(e){\r\n                console.log(e);\r\n                message.error(\"竞价失败\");\r\n            }\r\n        }\r\n        else{\r\n            message.info(\"您已经是出价最高的人了\")\r\n        }\r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <div style={{boxShadow: \"2px 2px 1px 2px #888\", margin: \"5px\"}}>\r\n                <PageHeader\r\n                    title={this.state.NFT.id}\r\n                    tags={<Tag color={this.state.tagColor}>{this.state.NFTState}</Tag>}\r\n                    extra={[\r\n                        <Button key=\"1\" type=\"primary\" disabled={this.state.bidButtonDisable} onClick={()=>this.setState({\r\n                            modalVisible: true,\r\n                        })}>\r\n                            竞价\r\n                        </Button>\r\n                    ]}\r\n                >\r\n                </PageHeader>\r\n                <Image width={200} height={200} src={this.state.NFT.uri} />\r\n                <Content>{this.renderContent()}</Content>\r\n                <Content>{this.renderOwners()}</Content>\r\n\r\n                <Modal\r\n                    visible={this.state.modalVisible}\r\n                    title=\"竞价\"\r\n                    okText=\"提交\"\r\n                    cancelText=\"取消\"\r\n                    onCancel={()=>{\r\n                        this.setState({\r\n                            modalVisible: false,\r\n                        })\r\n                    }}\r\n                    onOk={()=>{\r\n                        this.bid();\r\n                        this.formRef.current.resetFields();\r\n                    }}>\r\n                        <Form\r\n                            ref={this.formRef}\r\n                            layout=\"vertical\"\r\n                            name=\"bidForm\"\r\n                            initialValues={{modifier: 'public'}}\r\n                        >\r\n                            <Form.Item\r\n                                name=\"price\"\r\n                                label=\"出价\"\r\n                                rules={[{ required: true, message: '请填写您的出价' }]}\r\n                            >\r\n                                <InputNumber min={1} max={10000000000}></InputNumber>\r\n                            </Form.Item>\r\n\r\n                        </Form>\r\n                    </Modal>\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\nexport default MyMarketCard;"]},"metadata":{},"sourceType":"module"}