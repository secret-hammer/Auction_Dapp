{"ast":null,"code":"var _jsxFileName = \"/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/CreateTokenDrawer.js\";\nimport { create as ipfsHttpClient } from 'ipfs-http-client';\nimport React from 'react';\nimport 'antd/dist/antd.css';\nimport { Drawer, Form, Button, Space, Input, message, InputNumber } from 'antd';\nimport { PlusOutlined } from '@ant-design/icons';\nimport contractInstance from '../utils/config';\nimport web3 from '../utils/InitWeb3';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst client = ipfsHttpClient('https://ipfs.infura.io:5001/api/v0');\nexport default class CreateTokenDrawer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.formRef = /*#__PURE__*/React.createRef();\n\n    this.showDrawer = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.onClose = () => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.state = {\n      fileUrl: '',\n      visible: false\n    };\n    this.selectFile = this.selectFile.bind(this);\n    this.NFTCreate = this.NFTCreate.bind(this);\n  }\n\n  async selectFile(e) {\n    const file = e.target.files[0];\n\n    try {\n      const added = await client.add(file, {\n        progress: prog => console.log(`received:${prog}`)\n      });\n      const url = `https://ipfs.infura.io/ipfs/${added.path}`;\n      this.setState({\n        fileUrl: url\n      });\n    } catch (error) {\n      alert('Error uploading file: ', error);\n    }\n  }\n\n  async NFTCreate() {\n    let values = this.formRef.current.getFieldValue();\n    this.formRef.current.resetFields();\n    console.log(values);\n    let accounts = await web3.eth.getAccounts();\n    let uri = this.state.fileUrl;\n    let name = values.name;\n    let price = values.price;\n    let description = values.description;\n    console.log(uri, name, price, description);\n\n    try {\n      let tx = await contractInstance.methods.createNFT(uri, name, description, price).send({\n        from: accounts[0],\n        value: web3.utils.toWei('0.0001', 'ether'),\n        gas: 3000000\n      });\n      message.success('NFT铸造成功');\n      window.location.href = './Profile';\n    } catch (e) {\n      console.log(e);\n      message.error('NFT铸造失败');\n    }\n  }\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        type: \"primary\",\n        onClick: this.showDrawer,\n        icon: /*#__PURE__*/_jsxDEV(PlusOutlined, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 64\n        }, this),\n        children: \"Create NFT\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Drawer, {\n        title: \"Create NFT\",\n        width: 720,\n        onClose: this.onClose,\n        visible: this.state.visible,\n        bodyStyle: {\n          paddingBottom: 80\n        },\n        children: /*#__PURE__*/_jsxDEV(Form, {\n          ref: this.formRef,\n          layout: \"vertical\",\n          name: \"nftCreateForm\",\n          initialValues: {\n            modifier: 'public'\n          },\n          children: [/*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"name\",\n            label: \"Name\",\n            rules: [{\n              required: true,\n              message: '请输入NFT名称'\n            }],\n            children: /*#__PURE__*/_jsxDEV(Input, {\n              placeholder: \"NFT\\u540D\\u79F0\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 109,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 104,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"price\",\n            label: \"Price\",\n            rules: [{\n              required: true,\n              message: '请输入NFT价格(1~1000000)wei'\n            }],\n            children: /*#__PURE__*/_jsxDEV(InputNumber, {\n              min: 1,\n              max: 1000000,\n              placeholder: \"NFT Price in Eth\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 116,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"description\",\n            label: \"Description\",\n            rules: [{\n              required: true,\n              message: '请描述NFT'\n            }],\n            children: /*#__PURE__*/_jsxDEV(Input.TextArea, {\n              rows: 4,\n              placeholder: \"NFT description\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 128,\n              columnNumber: 19\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 118,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Form.Item, {\n            name: \"NFTdata\",\n            label: \"NFTdata\",\n            children: [/*#__PURE__*/_jsxDEV(Input, {\n              type: \"file\",\n              name: \"NFT\",\n              className: \"my-4\",\n              onChange: this.selectFile\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 134,\n              columnNumber: 21\n            }, this), this.state.fileUrl && /*#__PURE__*/_jsxDEV(\"img\", {\n              width: \"350\",\n              src: this.state.fileUrl\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 142,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 130,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            block: \"true\",\n            type: \"primary\",\n            htmlType: \"submit\",\n            onClick: this.NFTCreate,\n            children: \"\\u63D0\\u4EA4\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 146,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Space, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            block: \"true\",\n            type: \"primary\",\n            onClick: this.onClose,\n            children: \"\\u53D6\\u6D88\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 155,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true);\n  }\n\n}","map":{"version":3,"sources":["/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/CreateTokenDrawer.js"],"names":["create","ipfsHttpClient","React","Drawer","Form","Button","Space","Input","message","InputNumber","PlusOutlined","contractInstance","web3","client","CreateTokenDrawer","Component","constructor","props","formRef","createRef","showDrawer","setState","visible","onClose","state","fileUrl","selectFile","bind","NFTCreate","e","file","target","files","added","add","progress","prog","console","log","url","path","error","alert","values","current","getFieldValue","resetFields","accounts","eth","getAccounts","uri","name","price","description","tx","methods","createNFT","send","from","value","utils","toWei","gas","success","window","location","href","render","paddingBottom","modifier","required"],"mappings":"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","sourcesContent":["import { create as ipfsHttpClient } from 'ipfs-http-client';\r\nimport React from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport { Drawer, Form, Button, Space, Input, message, InputNumber } from 'antd';\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport contractInstance  from '../utils/config';\r\nimport web3 from '../utils/InitWeb3';\r\n\r\nconst client = ipfsHttpClient('https://ipfs.infura.io:5001/api/v0')\r\n\r\nexport default class CreateTokenDrawer extends React.Component{\r\n\r\n    formRef = React.createRef();\r\n\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.state = {\r\n            fileUrl: '',\r\n            visible: false,\r\n        }\r\n        this.selectFile = this.selectFile.bind(this);\r\n        this.NFTCreate = this.NFTCreate.bind(this);\r\n    }\r\n\r\n  showDrawer = () => {\r\n      this.setState({\r\n        visible: true,\r\n      });\r\n  };\r\n\r\n  onClose = () => {\r\n      this.setState({\r\n        visible: false,\r\n      });\r\n  };\r\n\r\n  async selectFile(e) {\r\n      const file = e.target.files[0];\r\n      try{\r\n          const added = await client.add(\r\n              file,\r\n              {\r\n                  progress: (prog) =>console.log(`received:${prog}`)\r\n              }\r\n          );\r\n          const url = `https://ipfs.infura.io/ipfs/${added.path}`;\r\n          this.setState({\r\n              fileUrl: url,\r\n          });\r\n      }catch (error) {\r\n          alert('Error uploading file: ', error);\r\n      }\r\n  }\r\n\r\n  async NFTCreate(){ \r\n      let values = this.formRef.current.getFieldValue();\r\n      this.formRef.current.resetFields();\r\n      console.log(values);\r\n\r\n      let accounts = await web3.eth.getAccounts();\r\n      let uri = this.state.fileUrl;\r\n      let name = values.name;\r\n      let price = values.price;\r\n      let description = values.description;\r\n\r\n      console.log(uri,name,price,description);\r\n      try{\r\n        let tx = await contractInstance.methods.createNFT(uri, name, description, price).send({\r\n            from: accounts[0],\r\n            value: web3.utils.toWei('0.0001', 'ether'),\r\n            gas: 3000000,\r\n        });\r\n        message.success('NFT铸造成功');\r\n        window.location.href = './Profile';\r\n      }\r\n      catch(e){\r\n        console.log(e);\r\n        message.error('NFT铸造失败');\r\n      }\r\n    \r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Button type=\"primary\" onClick={this.showDrawer} icon={<PlusOutlined />}>\r\n            Create NFT\r\n        </Button>\r\n        <Drawer\r\n          title=\"Create NFT\"\r\n          width={720}\r\n          onClose={this.onClose}\r\n          visible={this.state.visible}\r\n          bodyStyle={{ paddingBottom: 80 }}\r\n\r\n        >\r\n          <Form \r\n              ref={this.formRef}\r\n              layout=\"vertical\"\r\n              name=\"nftCreateForm\" \r\n              initialValues={{modifier: 'public'}}\r\n          >\r\n                <Form.Item\r\n                  name=\"name\"\r\n                  label=\"Name\"\r\n                  rules={[{ required: true, message: '请输入NFT名称' }]}\r\n                >\r\n                  <Input placeholder=\"NFT名称\" />\r\n                </Form.Item>\r\n                <Form.Item\r\n                  name=\"price\"\r\n                  label=\"Price\"\r\n                  rules={[{ required: true, message: '请输入NFT价格(1~1000000)wei' }]}\r\n                >\r\n                  <InputNumber min={1} max={1000000} placeholder=\"NFT Price in Eth\" />\r\n                </Form.Item>\r\n                <Form.Item\r\n                  name=\"description\"\r\n                  label=\"Description\"\r\n                  rules={[\r\n                    {\r\n                      required: true,\r\n                      message: '请描述NFT',\r\n                    },\r\n                  ]}\r\n                >\r\n                  <Input.TextArea rows={4} placeholder=\"NFT description\" />\r\n                </Form.Item>\r\n                <Form.Item\r\n                  name=\"NFTdata\"\r\n                  label=\"NFTdata\"\r\n                >\r\n                    <Input\r\n                        type=\"file\"\r\n                        name=\"NFT\"\r\n                        className=\"my-4\"\r\n                        onChange={this.selectFile}\r\n                    />\r\n                    {\r\n                        this.state.fileUrl && (\r\n                            <img width=\"350\" src={this.state.fileUrl} />\r\n                        )\r\n                    }\r\n                </Form.Item>\r\n                <Button \r\n                    block='true' \r\n                    type='primary' \r\n                    htmlType=\"submit\" \r\n                    onClick={this.NFTCreate}\r\n                >\r\n                    提交\r\n                </Button>\r\n                <Space />\r\n                <Button block='true' type='primary' onClick={this.onClose}>\r\n                    取消\r\n                </Button>\r\n            </Form>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}