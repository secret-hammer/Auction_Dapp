{"ast":null,"code":"import _regeneratorRuntime from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'antd/dist/antd.css';import{Tag,Image,Form,List,Typography,Layout,Button,Descriptions,PageHeader,Modal,InputNumber,message}from'antd';import contractInstance from'../../utils/config';import web3 from'../../utils/InitWeb3';import{FileProtectOutlined}from'@ant-design/icons';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Content=Layout.Content;var MyBidCard=/*#__PURE__*/function(_React$Component){_inherits(MyBidCard,_React$Component);var _super=_createSuper(MyBidCard);function MyBidCard(props){var _this;_classCallCheck(this,MyBidCard);_this=_super.call(this,props);_this.formRef=/*#__PURE__*/React.createRef();_this.renderContent=function(){var column=arguments.length>0&&arguments[0]!==undefined?arguments[0]:2;return/*#__PURE__*/_jsxs(Descriptions,{size:\"small\",column:column,bordered:true,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u540D\\u79F0\",children:_this.state.NFT.name}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u63CF\\u8FF0\",children:_this.state.NFT.description}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"\\u8D77\\u62CD\\u4EF7\\u683C\",children:[web3.utils.fromWei(_this.state.startPrice.toString(),\"ether\"),\" ether\"]}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u4EF7\\u683C\",children:[web3.utils.fromWei(_this.state.NFT.currentprice.toString(),\"ether\"),\"  ether\"]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u6536\\u85CF\\u54C1\\u6240\\u6709\\u8005\",children:_this.state.auctionowner}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u51FA\\u4EF7\\u8005\",children:_this.state.NFT.currentowner})]});};_this.renderOwners=function(){return/*#__PURE__*/_jsx(List,{header:/*#__PURE__*/_jsx(\"div\",{children:\"\\u6D41\\u8F6C\\u4FE1\\u606F\"}),bordered:true,dataSource:_this.state.owners,renderItem:function renderItem(item){return/*#__PURE__*/_jsxs(List.Item,{children:[/*#__PURE__*/_jsx(Typography.Text,{mark:true,children:\"[ADDRESS]\"}),\" \",item]});}});};_this.state={NFT:props.NFT,isConnected:false,address:\"\",bidButtonDisable:true,claimButtonDisable:false,tagColor:\"red\",NFTState:\"正在拍卖\",modalVisible:false,startPrice:0,auctionowner:\"\",owners:[]};_this.renderContent=_this.renderContent.bind(_assertThisInitialized(_this));_this.claim=_this.claim.bind(_assertThisInitialized(_this));return _this;}_createClass(MyBidCard,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var accounts,NFT,ret,owners,_ret,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return web3.eth.getAccounts();case 2:accounts=_context.sent;if(!(accounts.length==0)){_context.next=7;break;}this.setState({isConnected:false});_context.next=38;break;case 7:this.setState({isConnected:true,address:accounts[0]});NFT=this.state.NFT;console.log(NFT.currentprice);if(NFT.onsale==true){this.setState({NFTState:\"拍卖中\",tagColor:\"red\",bidButtonDisable:false,claimButtonDisable:true});}else if(NFT.setaside==true){this.setState({NFTState:\"拍卖结束（等待申领）\",tagColor:\"green\",bidButtonDisable:true,claimButtonDisable:false});}_context.next=13;return contractInstance.methods.bidprices(NFT.id,0).call();case 13:ret=_context.sent;console.log(ret);this.setState({startPrice:ret});_context.next=18;return contractInstance.methods.ownerOf(NFT.id).call();case 18:ret=_context.sent;this.setState({auctionowner:ret});//获取流转信息\n_context.prev=20;owners=[];i=0;case 23:if(!(i<NFT.ownerNum)){_context.next=31;break;}_context.next=26;return contractInstance.methods.owners(NFT.id,i).call();case 26:_ret=_context.sent;owners.push(_ret);case 28:i++;_context.next=23;break;case 31:console.log(owners);this.setState({owners:owners});_context.next=38;break;case 35:_context.prev=35;_context.t0=_context[\"catch\"](20);console.log(_context.t0);case 38:case\"end\":return _context.stop();}}},_callee,this,[[20,35]]);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"bid\",value://竞拍函数\nfunction(){var _bid=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var NFT,values,tx;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:NFT=this.state.NFT;values=this.formRef.current.getFieldValue();if(NFT.currentowner!=this.state.address){try{tx=contractInstance.methods.bid(Number(NFT.id),web3.utils.toWei(values.price.toString(),\"ether\")).send({from:this.state.address,value:web3.utils.toWei('0.00000001','ether')});message.success('竞价成功');window.location.reload();}catch(e){console.log(e);message.error(\"竞价失败\");}}else{message.info(\"您已经是出价最高的人了\");}case 3:case\"end\":return _context2.stop();}}},_callee2,this);}));function bid(){return _bid.apply(this,arguments);}return bid;}()},{key:\"claim\",value:function(){var _claim=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var NFT,tx;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:NFT=this.state.NFT;if(!(NFT.currentowner==this.state.address)){_context3.next=16;break;}_context3.prev=2;_context3.next=5;return contractInstance.methods.claim(Number(NFT.id)).send({from:this.state.address,value:NFT.currentprice});case 5:tx=_context3.sent;message.success('认领成功');window.location.reload();_context3.next=14;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](2);console.log(_context3.t0);message.error(\"认领失败\");case 14:_context3.next=17;break;case 16:message.error(\"非竞拍成功者不可认领\");case 17:case\"end\":return _context3.stop();}}},_callee3,this,[[2,10]]);}));function claim(){return _claim.apply(this,arguments);}return claim;}()},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsxs(\"div\",{style:{boxShadow:\"2px 2px 1px 2px #888\",margin:\"5px\"},children:[/*#__PURE__*/_jsx(PageHeader,{title:this.state.NFT.id,tags:/*#__PURE__*/_jsx(Tag,{color:this.state.tagColor,children:this.state.NFTState}),extra:([/*#__PURE__*/_jsx(Button,{type:\"primary\",disabled:this.state.bidButtonDisable,onClick:function onClick(){return _this2.setState({modalVisible:true});},children:\"\\u7ADE\\u4EF7\"},\"1\")],[/*#__PURE__*/_jsx(Button,{type:\"primary\",disabled:this.state.claimButtonDisable,onClick:this.claim,children:\"\\u8BA4\\u9886\"},\"2\")])}),/*#__PURE__*/_jsx(Image,{width:200,height:200,src:this.state.NFT.uri}),/*#__PURE__*/_jsx(Content,{children:this.renderContent()}),/*#__PURE__*/_jsx(Content,{children:this.renderOwners()}),/*#__PURE__*/_jsx(Modal,{visible:this.state.modalVisible,title:\"\\u7ADE\\u4EF7\",okText:\"\\u63D0\\u4EA4\",cancelText:\"\\u53D6\\u6D88\",onCancel:function onCancel(){_this2.setState({modalVisible:false});},onOk:function onOk(){_this2.bid();_this2.formRef.current.resetFields();},children:/*#__PURE__*/_jsx(Form,{ref:this.formRef,layout:\"vertical\",name:\"bidForm\",initialValues:{modifier:'public'},children:/*#__PURE__*/_jsx(Form.Item,{name:\"price\",label:\"\\u51FA\\u4EF7\",rules:[{required:true,message:'请填写您的出价'}],children:/*#__PURE__*/_jsx(InputNumber,{min:1,max:10000000000})})})})]});}}]);return MyBidCard;}(React.Component);export{MyBidCard as default};","map":{"version":3,"sources":["/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/card/my-bid-card.js"],"names":["React","Tag","Image","Form","List","Typography","Layout","Button","Descriptions","PageHeader","Modal","InputNumber","message","contractInstance","web3","FileProtectOutlined","Content","MyBidCard","props","formRef","createRef","renderContent","column","state","NFT","name","description","utils","fromWei","startPrice","toString","currentprice","auctionowner","currentowner","renderOwners","owners","item","isConnected","address","bidButtonDisable","claimButtonDisable","tagColor","NFTState","modalVisible","bind","claim","eth","getAccounts","accounts","length","setState","console","log","onsale","setaside","methods","bidprices","id","call","ret","ownerOf","i","ownerNum","push","values","current","getFieldValue","tx","bid","Number","toWei","price","send","from","value","success","window","location","reload","e","error","info","boxShadow","margin","uri","resetFields","modifier","required","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport { Tag, Image, Form, List, Typography, Layout, Button, Descriptions, PageHeader, Modal, InputNumber, message } from 'antd';\r\nimport contractInstance from '../../utils/config';\r\nimport web3 from '../../utils/InitWeb3';\r\nimport { FileProtectOutlined } from '@ant-design/icons';\r\n\r\nconst {Content} = Layout;\r\n\r\nexport default class MyBidCard extends React.Component{\r\n\r\n    formRef = React.createRef();\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = ({\r\n            NFT: props.NFT,\r\n            isConnected: false,\r\n            address: \"\",\r\n            bidButtonDisable: true,\r\n            claimButtonDisable: false,\r\n            tagColor: \"red\",\r\n            NFTState: \"正在拍卖\",\r\n            modalVisible: false,\r\n            startPrice: 0,\r\n            auctionowner: \"\",\r\n            owners: [],\r\n        })\r\n\r\n        this.renderContent = this.renderContent.bind(this);\r\n        this.claim = this.claim.bind(this);\r\n    }\r\n\r\n    async componentDidMount(){\r\n\r\n        let accounts = await web3.eth.getAccounts()\r\n        if (accounts.length == 0) {\r\n            this.setState({\r\n                isConnected: false\r\n            })\r\n        }\r\n        else {\r\n            this.setState({\r\n                isConnected: true,\r\n                address: accounts[0]\r\n            })\r\n\r\n            let NFT = this.state.NFT;\r\n            console.log(NFT.currentprice)\r\n            if(NFT.onsale == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖中\",\r\n                    tagColor: \"red\",\r\n                    bidButtonDisable: false,\r\n                    claimButtonDisable: true,\r\n                })\r\n            }\r\n            else if(NFT.setaside == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖结束（等待申领）\",\r\n                    tagColor: \"green\",\r\n                    bidButtonDisable: true,\r\n                    claimButtonDisable: false,\r\n                })\r\n            }\r\n\r\n            let ret = await contractInstance.methods.bidprices(NFT.id, 0).call();\r\n            console.log(ret);\r\n            this.setState({\r\n                startPrice: ret,\r\n            })\r\n\r\n            ret = await contractInstance.methods.ownerOf(NFT.id).call();\r\n            this.setState({\r\n                auctionowner: ret,\r\n            })\r\n\r\n            //获取流转信息\r\n            try{\r\n                let owners = [], ret;\r\n                for(let i = 0; i < NFT.ownerNum; i++){\r\n                    ret = await contractInstance.methods.owners(NFT.id, i).call();\r\n                    owners.push(ret);\r\n                }\r\n                console.log(owners);\r\n                this.setState({\r\n                    owners: owners,\r\n                })\r\n            }\r\n            catch(e){\r\n                console.log(e);\r\n            }\r\n        }\r\n    }\r\n    \r\n    renderContent = (column = 2) =>(\r\n        <Descriptions size=\"small\" column={column} bordered>\r\n            <Descriptions.Item label=\"名称\">{this.state.NFT.name}</Descriptions.Item>\r\n            <Descriptions.Item label=\"描述\">{this.state.NFT.description}</Descriptions.Item>\r\n            <Descriptions.Item label=\"起拍价格\">{web3.utils.fromWei((this.state.startPrice).toString(), \"ether\")} ether</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高价格\">{web3.utils.fromWei((this.state.NFT.currentprice).toString(), \"ether\")}  ether</Descriptions.Item>\r\n            <Descriptions.Item label=\"收藏品所有者\">{this.state.auctionowner}</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高出价者\">{this.state.NFT.currentowner}</Descriptions.Item>\r\n        </Descriptions>\r\n    );\r\n\r\n    renderOwners = () =>(\r\n        <List\r\n        header={<div>流转信息</div>}\r\n        bordered\r\n        dataSource={this.state.owners}\r\n        renderItem={item => (\r\n            <List.Item>\r\n                <Typography.Text mark>[ADDRESS]</Typography.Text> {item}\r\n            </List.Item>\r\n      )}\r\n        />\r\n    );\r\n\r\n    //竞拍函数\r\n    async bid(){\r\n        let NFT = this.state.NFT;\r\n        let values = this.formRef.current.getFieldValue();\r\n\r\n        if(NFT.currentowner != this.state.address){\r\n            try{\r\n                let tx = contractInstance.methods.bid(Number(NFT.id), web3.utils.toWei((values.price).toString(), \"ether\")).send({\r\n                    from: this.state.address,\r\n                    value: web3.utils.toWei('0.00000001', 'ether'),\r\n                });\r\n                message.success('竞价成功');\r\n                window.location.reload();\r\n            }\r\n            catch(e){\r\n                console.log(e);\r\n                message.error(\"竞价失败\");\r\n            }\r\n        }\r\n        else{\r\n            message.info(\"您已经是出价最高的人了\")\r\n        }\r\n    }\r\n\r\n    async claim(){\r\n        let NFT = this.state.NFT;\r\n        if(NFT.currentowner == this.state.address){\r\n            try{\r\n                let tx = await contractInstance.methods.claim(Number(NFT.id)).send({\r\n                    from: this.state.address,\r\n                    value: NFT.currentprice,\r\n                })\r\n                message.success('认领成功');\r\n                window.location.reload();\r\n            }\r\n            catch(e){\r\n                console.log(e);\r\n                message.error(\"认领失败\");\r\n            }\r\n        }\r\n        else{\r\n            message.error(\"非竞拍成功者不可认领\");\r\n        }\r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <div style={{boxShadow: \"2px 2px 1px 2px #888\", margin: \"5px\"}}>\r\n                <PageHeader\r\n                    title={this.state.NFT.id}\r\n                    tags={<Tag color={this.state.tagColor}>{this.state.NFTState}</Tag>}\r\n                    extra={[\r\n                        <Button key=\"1\" type=\"primary\" disabled={this.state.bidButtonDisable} onClick={()=>this.setState({\r\n                            modalVisible: true,\r\n                        })}>\r\n                            竞价\r\n                        </Button>\r\n                        \r\n                    ],\r\n                    [\r\n                        <Button key=\"2\" type=\"primary\" disabled={this.state.claimButtonDisable} onClick={this.claim}>\r\n                            认领\r\n                        </Button>\r\n                    ]}>\r\n                </PageHeader>\r\n                <Image width={200} height={200} src={this.state.NFT.uri} />\r\n                <Content>{this.renderContent()}</Content>\r\n                <Content>{this.renderOwners()}</Content>\r\n\r\n                <Modal\r\n                    visible={this.state.modalVisible}\r\n                    title=\"竞价\"\r\n                    okText=\"提交\"\r\n                    cancelText=\"取消\"\r\n                    onCancel={()=>{\r\n                        this.setState({\r\n                            modalVisible: false,\r\n                        })\r\n                    }}\r\n                    onOk={()=>{\r\n                        this.bid();\r\n                        this.formRef.current.resetFields();\r\n                    }}>\r\n                        <Form\r\n                            ref={this.formRef}\r\n                            layout=\"vertical\"\r\n                            name=\"bidForm\"\r\n                            initialValues={{modifier: 'public'}}\r\n                        >\r\n                            <Form.Item\r\n                                name=\"price\"\r\n                                label=\"出价\"\r\n                                rules={[{ required: true, message: '请填写您的出价' }]}\r\n                            >\r\n                                <InputNumber min={1} max={10000000000}></InputNumber>\r\n                            </Form.Item>\r\n\r\n                        </Form>\r\n                    </Modal>\r\n            </div>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}