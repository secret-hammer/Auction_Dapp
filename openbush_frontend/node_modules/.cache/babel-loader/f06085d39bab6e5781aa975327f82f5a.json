{"ast":null,"code":"import _regeneratorRuntime from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";import React from'react';import'antd/dist/antd.css';import{Tag,Image,Layout,Button,Descriptions,PageHeader,List,Typography,message}from'antd';import contractInstance from'../../utils/config';import web3 from'../../utils/InitWeb3';import{FileProtectOutlined}from'@ant-design/icons';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Content=Layout.Content;var MyAuctionCard=/*#__PURE__*/function(_React$Component){_inherits(MyAuctionCard,_React$Component);var _super=_createSuper(MyAuctionCard);function MyAuctionCard(props){var _this;_classCallCheck(this,MyAuctionCard);_this=_super.call(this,props);_this.renderContent=function(){var column=arguments.length>0&&arguments[0]!==undefined?arguments[0]:2;return/*#__PURE__*/_jsxs(Descriptions,{size:\"small\",column:column,bordered:true,children:[/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u540D\\u79F0\",children:_this.state.NFT.name}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u63CF\\u8FF0\",children:_this.state.NFT.description}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"\\u8D77\\u62CD\\u4EF7\\u683C\",children:[web3.utils.fromWei(_this.state.startPrice.toString(),\"ether\"),\" ether\"]}),/*#__PURE__*/_jsxs(Descriptions.Item,{label:\"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u4EF7\\u683C\",children:[web3.utils.fromWei(_this.state.NFT.currentprice.toString(),\"ether\"),\"  ether\"]}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u6536\\u85CF\\u54C1\\u6240\\u6709\\u8005\",children:_this.state.auctionowner}),/*#__PURE__*/_jsx(Descriptions.Item,{label:\"\\u5F53\\u524D\\u62CD\\u5356\\u6700\\u9AD8\\u51FA\\u4EF7\\u8005\",children:_this.state.NFT.currentowner})]});};_this.renderOwners=function(){return/*#__PURE__*/_jsx(List,{header:/*#__PURE__*/_jsx(\"div\",{children:\"\\u6D41\\u8F6C\\u4FE1\\u606F\"}),bordered:true,dataSource:_this.state.owners,renderItem:function renderItem(item){return/*#__PURE__*/_jsxs(List.Item,{children:[/*#__PURE__*/_jsx(Typography.Text,{mark:true,children:\"[ADDRESS]\"}),\" \",item]});}});};_this.state={NFT:props.NFT,isConnected:false,address:\"\",buttonDisable:false,tagColor:\"red\",NFTState:\"正在拍卖\",startPrice:0,modalVisible:true,auctionowner:\"\",owners:[]};_this.renderContent=_this.renderContent.bind(_assertThisInitialized(_this));_this.approve=_this.approve.bind(_assertThisInitialized(_this));return _this;}_createClass(MyAuctionCard,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var accounts,NFT,ret,owners,_ret,i;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return web3.eth.getAccounts();case 2:accounts=_context.sent;if(!(accounts.length==0)){_context.next=7;break;}this.setState({isConnected:false});_context.next=37;break;case 7:this.setState({isConnected:true,address:accounts[0]});NFT=this.state.NFT;//设定拍卖状态\nif(NFT.onsale==true){this.setState({NFTState:\"拍卖中\",tagColor:\"red\",buttonDisable:true});}else if(NFT.setaside==true){this.setState({NFTState:\"拍卖结束（等待申领）\",tagColor:\"green\",buttonDisable:false});}//得到拍卖信息\n_context.next=12;return contractInstance.methods.bidprices(NFT.id,0).call();case 12:ret=_context.sent;console.log(ret);this.setState({startPrice:ret});_context.next=17;return contractInstance.methods.ownerOf(NFT.id).call();case 17:ret=_context.sent;this.setState({auctionowner:ret});//获取流转信息\n_context.prev=19;owners=[];i=0;case 22:if(!(i<NFT.ownerNum)){_context.next=30;break;}_context.next=25;return contractInstance.methods.owners(NFT.id,i).call();case 25:_ret=_context.sent;owners.push(_ret);case 27:i++;_context.next=22;break;case 30:console.log(owners);this.setState({owners:owners});_context.next=37;break;case 34:_context.prev=34;_context.t0=_context[\"catch\"](19);console.log(_context.t0);case 37:case\"end\":return _context.stop();}}},_callee,this,[[19,34]]);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"approve\",value://卖方许可函数\nfunction(){var _approve=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var NFT,tx;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:NFT=this.state.NFT;console.log(NFT.id);_context2.prev=2;_context2.next=5;return contractInstance.methods.sellerApprove(Number(NFT.id)).send({from:this.state.address,gas:30000000});case 5:tx=_context2.sent;message.success('卖方确认交易成功');this.setstate({buttonDisable:true});window.location.reload();_context2.next=15;break;case 11:_context2.prev=11;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0);window.location.reload();case 15:case\"end\":return _context2.stop();}}},_callee2,this,[[2,11]]);}));function approve(){return _approve.apply(this,arguments);}return approve;}()},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(\"div\",{style:{boxShadow:\"2px 2px 1px 2px #888\",margin:\"5px\"},children:[/*#__PURE__*/_jsx(PageHeader,{title:this.state.NFT.id,tags:/*#__PURE__*/_jsx(Tag,{color:this.state.tagColor,children:this.state.NFTState}),extra:[/*#__PURE__*/_jsx(Button,{type:\"primary\",disabled:this.state.buttonDisable,onClick:this.approve,children:\"\\u51FA\\u552E\\u8BB8\\u53EF\"},\"1\")]}),/*#__PURE__*/_jsx(Image,{width:200,height:200,src:this.state.NFT.uri}),/*#__PURE__*/_jsx(Content,{children:this.renderContent()}),/*#__PURE__*/_jsx(Content,{children:this.renderOwners()})]});}}]);return MyAuctionCard;}(React.Component);export{MyAuctionCard as default};","map":{"version":3,"sources":["/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/card/my-auction-card.js"],"names":["React","Tag","Image","Layout","Button","Descriptions","PageHeader","List","Typography","message","contractInstance","web3","FileProtectOutlined","Content","MyAuctionCard","props","renderContent","column","state","NFT","name","description","utils","fromWei","startPrice","toString","currentprice","auctionowner","currentowner","renderOwners","owners","item","isConnected","address","buttonDisable","tagColor","NFTState","modalVisible","bind","approve","eth","getAccounts","accounts","length","setState","onsale","setaside","methods","bidprices","id","call","ret","console","log","ownerOf","i","ownerNum","push","sellerApprove","Number","send","from","gas","tx","success","setstate","window","location","reload","boxShadow","margin","uri","Component"],"mappings":"y5BAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAO,oBAAP,CACA,OAASC,GAAT,CAAcC,KAAd,CAAqBC,MAArB,CAA6BC,MAA7B,CAAqCC,YAArC,CAAmDC,UAAnD,CAA+DC,IAA/D,CAAqEC,UAArE,CAAiFC,OAAjF,KAAgG,MAAhG,CACA,MAAOC,CAAAA,gBAAP,KAA6B,oBAA7B,CACA,MAAOC,CAAAA,IAAP,KAAiB,sBAAjB,CACA,OAASC,mBAAT,KAAoC,mBAApC,C,wFAEA,GAAOC,CAAAA,OAAP,CAAkBV,MAAlB,CAAOU,OAAP,C,GAEqBC,CAAAA,a,0HAEjB,uBAAYC,KAAZ,CAAkB,+CACd,uBAAMA,KAAN,EADc,MAiFlBC,aAjFkB,CAiFF,cAACC,CAAAA,MAAD,2DAAU,CAAV,oBACZ,MAAC,YAAD,EAAc,IAAI,CAAC,OAAnB,CAA2B,MAAM,CAAEA,MAAnC,CAA2C,QAAQ,KAAnD,wBACI,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,cAAzB,UAA+B,MAAKC,KAAL,CAAWC,GAAX,CAAeC,IAA9C,EADJ,cAEI,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,cAAzB,UAA+B,MAAKF,KAAL,CAAWC,GAAX,CAAeE,WAA9C,EAFJ,cAGI,MAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,0BAAzB,WAAiCV,IAAI,CAACW,KAAL,CAAWC,OAAX,CAAoB,MAAKL,KAAL,CAAWM,UAAZ,CAAwBC,QAAxB,EAAnB,CAAuD,OAAvD,CAAjC,YAHJ,cAII,MAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,kDAAzB,WAAqCd,IAAI,CAACW,KAAL,CAAWC,OAAX,CAAoB,MAAKL,KAAL,CAAWC,GAAX,CAAeO,YAAhB,CAA8BD,QAA9B,EAAnB,CAA6D,OAA7D,CAArC,aAJJ,cAKI,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,sCAAzB,UAAmC,MAAKP,KAAL,CAAWS,YAA9C,EALJ,cAMI,KAAC,YAAD,CAAc,IAAd,EAAmB,KAAK,CAAC,wDAAzB,UAAsC,MAAKT,KAAL,CAAWC,GAAX,CAAeS,YAArD,EANJ,GADY,EAjFE,OA4FlBC,YA5FkB,CA4FH,8BACX,KAAC,IAAD,EACA,MAAM,cAAE,iDADR,CAEA,QAAQ,KAFR,CAGA,UAAU,CAAE,MAAKX,KAAL,CAAWY,MAHvB,CAIA,UAAU,CAAE,oBAAAC,IAAI,qBACZ,MAAC,IAAD,CAAM,IAAN,yBACI,KAAC,UAAD,CAAY,IAAZ,EAAiB,IAAI,KAArB,uBADJ,KACuDA,IADvD,GADY,EAJhB,EADW,EA5FG,CAEd,MAAKb,KAAL,CAAc,CACVC,GAAG,CAAEJ,KAAK,CAACI,GADD,CAEVa,WAAW,CAAE,KAFH,CAGVC,OAAO,CAAE,EAHC,CAIVC,aAAa,CAAE,KAJL,CAKVC,QAAQ,CAAE,KALA,CAMVC,QAAQ,CAAE,MANA,CAOVZ,UAAU,CAAE,CAPF,CAQVa,YAAY,CAAE,IARJ,CASVV,YAAY,CAAE,EATJ,CAUVG,MAAM,CAAE,EAVE,CAAd,CAaA,MAAKd,aAAL,CAAqB,MAAKA,aAAL,CAAmBsB,IAAnB,+BAArB,CACA,MAAKC,OAAL,CAAe,MAAKA,OAAL,CAAaD,IAAb,+BAAf,CAhBc,aAiBjB,C,qJAED,4LAEyB3B,CAAAA,IAAI,CAAC6B,GAAL,CAASC,WAAT,EAFzB,QAEQC,QAFR,oBAGQA,QAAQ,CAACC,MAAT,EAAmB,CAH3B,0BAIQ,KAAKC,QAAL,CAAc,CACVZ,WAAW,CAAE,KADH,CAAd,EAJR,8BASQ,KAAKY,QAAL,CAAc,CACVZ,WAAW,CAAE,IADH,CAEVC,OAAO,CAAES,QAAQ,CAAC,CAAD,CAFP,CAAd,EAKIvB,GAdZ,CAckB,KAAKD,KAAL,CAAWC,GAd7B,CAgBQ;AACA,GAAGA,GAAG,CAAC0B,MAAJ,EAAc,IAAjB,CAAsB,CAClB,KAAKD,QAAL,CAAc,CACVR,QAAQ,CAAE,KADA,CAEVD,QAAQ,CAAE,KAFA,CAGVD,aAAa,CAAE,IAHL,CAAd,EAKH,CAND,IAOK,IAAGf,GAAG,CAAC2B,QAAJ,EAAgB,IAAnB,CAAwB,CACzB,KAAKF,QAAL,CAAc,CACVR,QAAQ,CAAE,YADA,CAEVD,QAAQ,CAAE,OAFA,CAGVD,aAAa,CAAE,KAHL,CAAd,EAKH,CAED;AAhCR,uBAiCwBxB,CAAAA,gBAAgB,CAACqC,OAAjB,CAAyBC,SAAzB,CAAmC7B,GAAG,CAAC8B,EAAvC,CAA2C,CAA3C,EAA8CC,IAA9C,EAjCxB,SAiCYC,GAjCZ,eAkCQC,OAAO,CAACC,GAAR,CAAYF,GAAZ,EACA,KAAKP,QAAL,CAAc,CACVpB,UAAU,CAAE2B,GADF,CAAd,EAnCR,uBAuCoBzC,CAAAA,gBAAgB,CAACqC,OAAjB,CAAyBO,OAAzB,CAAiCnC,GAAG,CAAC8B,EAArC,EAAyCC,IAAzC,EAvCpB,SAuCQC,GAvCR,eAwCQ,KAAKP,QAAL,CAAc,CACVjB,YAAY,CAAEwB,GADJ,CAAd,EAIA;AA5CR,iBA8CgBrB,MA9ChB,CA8CyB,EA9CzB,CA+CoByB,CA/CpB,CA+CwB,CA/CxB,cA+C2BA,CAAC,CAAGpC,GAAG,CAACqC,QA/CnC,kDAgD4B9C,CAAAA,gBAAgB,CAACqC,OAAjB,CAAyBjB,MAAzB,CAAgCX,GAAG,CAAC8B,EAApC,CAAwCM,CAAxC,EAA2CL,IAA3C,EAhD5B,SAgDgBC,IAhDhB,eAiDgBrB,MAAM,CAAC2B,IAAP,CAAYN,IAAZ,EAjDhB,QA+C6CI,CAAC,EA/C9C,gCAmDYH,OAAO,CAACC,GAAR,CAAYvB,MAAZ,EACA,KAAKc,QAAL,CAAc,CACVd,MAAM,CAAEA,MADE,CAAd,EApDZ,kFAyDYsB,OAAO,CAACC,GAAR,cAzDZ,sE,oIAsFA;gFACA,mJACQlC,GADR,CACc,KAAKD,KAAL,CAAWC,GADzB,CAEIiC,OAAO,CAACC,GAAR,CAAYlC,GAAG,CAAC8B,EAAhB,EAFJ,wCAIuBvC,CAAAA,gBAAgB,CAACqC,OAAjB,CAAyBW,aAAzB,CAAuCC,MAAM,CAACxC,GAAG,CAAC8B,EAAL,CAA7C,EAAwDW,IAAxD,CAA6D,CACxEC,IAAI,CAAE,KAAK3C,KAAL,CAAWe,OADuD,CAExE6B,GAAG,CAAE,QAFmE,CAA7D,CAJvB,QAIYC,EAJZ,gBAQQtD,OAAO,CAACuD,OAAR,CAAgB,UAAhB,EACA,KAAKC,QAAL,CAAc,CACV/B,aAAa,CAAE,IADL,CAAd,EAGAgC,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GAZR,qFAeQhB,OAAO,CAACC,GAAR,eACAa,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GAhBR,uE,qGAoBA,iBAAQ,CACJ,mBACI,aAAK,KAAK,CAAE,CAACC,SAAS,CAAE,sBAAZ,CAAoCC,MAAM,CAAE,KAA5C,CAAZ,wBACI,KAAC,UAAD,EACI,KAAK,CAAG,KAAKpD,KAAL,CAAWC,GAAX,CAAe8B,EAD3B,CAEI,IAAI,cAAE,KAAC,GAAD,EAAK,KAAK,CAAE,KAAK/B,KAAL,CAAWiB,QAAvB,UAAkC,KAAKjB,KAAL,CAAWkB,QAA7C,EAFV,CAGI,KAAK,CAAE,cACH,KAAC,MAAD,EAAgB,IAAI,CAAC,SAArB,CAA+B,QAAQ,CAAE,KAAKlB,KAAL,CAAWgB,aAApD,CAAmE,OAAO,CAAE,KAAKK,OAAjF,sCAAY,GAAZ,CADG,CAHX,EADJ,cAUI,KAAC,KAAD,EAAO,KAAK,CAAE,GAAd,CAAmB,MAAM,CAAE,GAA3B,CAAgC,GAAG,CAAE,KAAKrB,KAAL,CAAWC,GAAX,CAAeoD,GAApD,EAVJ,cAWI,KAAC,OAAD,WAAU,KAAKvD,aAAL,EAAV,EAXJ,cAYI,KAAC,OAAD,WAAU,KAAKa,YAAL,EAAV,EAZJ,GADJ,CAgBH,C,2BAjJsC7B,KAAK,CAACwE,S,SAA5B1D,a","sourcesContent":["import React from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport { Tag, Image, Layout, Button, Descriptions, PageHeader, List, Typography, message } from 'antd';\r\nimport contractInstance from '../../utils/config';\r\nimport web3 from '../../utils/InitWeb3';\r\nimport { FileProtectOutlined } from '@ant-design/icons';\r\n\r\nconst {Content} = Layout;\r\n\r\nexport default class MyAuctionCard extends React.Component{\r\n\r\n    constructor(props){\r\n        super(props);\r\n        this.state = ({\r\n            NFT: props.NFT,\r\n            isConnected: false,\r\n            address: \"\",\r\n            buttonDisable: false,\r\n            tagColor: \"red\",\r\n            NFTState: \"正在拍卖\",\r\n            startPrice: 0,\r\n            modalVisible: true,\r\n            auctionowner: \"\",\r\n            owners: [],\r\n        })\r\n\r\n        this.renderContent = this.renderContent.bind(this);\r\n        this.approve = this.approve.bind(this);\r\n    }\r\n\r\n    async componentDidMount(){\r\n\r\n        let accounts = await web3.eth.getAccounts()\r\n        if (accounts.length == 0) {\r\n            this.setState({\r\n                isConnected: false\r\n            })\r\n        }\r\n        else {\r\n            this.setState({\r\n                isConnected: true,\r\n                address: accounts[0]\r\n            })\r\n\r\n            let NFT = this.state.NFT;\r\n            \r\n            //设定拍卖状态\r\n            if(NFT.onsale == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖中\",\r\n                    tagColor: \"red\",\r\n                    buttonDisable: true,\r\n                })\r\n            }\r\n            else if(NFT.setaside == true){\r\n                this.setState({\r\n                    NFTState: \"拍卖结束（等待申领）\",\r\n                    tagColor: \"green\",\r\n                    buttonDisable: false,\r\n                })\r\n            }\r\n\r\n            //得到拍卖信息\r\n            let ret = await contractInstance.methods.bidprices(NFT.id, 0).call();\r\n            console.log(ret);\r\n            this.setState({\r\n                startPrice: ret,\r\n            })\r\n\r\n            ret = await contractInstance.methods.ownerOf(NFT.id).call();\r\n            this.setState({\r\n                auctionowner: ret,\r\n            })\r\n\r\n            //获取流转信息\r\n            try{\r\n                let owners = [], ret;\r\n                for(let i = 0; i < NFT.ownerNum; i++){\r\n                    ret = await contractInstance.methods.owners(NFT.id, i).call();\r\n                    owners.push(ret);\r\n                }\r\n                console.log(owners);\r\n                this.setState({\r\n                    owners: owners,\r\n                })\r\n            }\r\n            catch(e){\r\n                console.log(e);\r\n            }\r\n        }\r\n    }\r\n    \r\n    renderContent = (column = 2) =>(\r\n        <Descriptions size=\"small\" column={column} bordered>\r\n            <Descriptions.Item label=\"名称\">{this.state.NFT.name}</Descriptions.Item>\r\n            <Descriptions.Item label=\"描述\">{this.state.NFT.description}</Descriptions.Item>\r\n            <Descriptions.Item label=\"起拍价格\">{web3.utils.fromWei((this.state.startPrice).toString(), \"ether\")} ether</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高价格\">{web3.utils.fromWei((this.state.NFT.currentprice).toString(), \"ether\")}  ether</Descriptions.Item>\r\n            <Descriptions.Item label=\"收藏品所有者\">{this.state.auctionowner}</Descriptions.Item>\r\n            <Descriptions.Item label=\"当前拍卖最高出价者\">{this.state.NFT.currentowner}</Descriptions.Item>\r\n        </Descriptions>\r\n    );\r\n\r\n    renderOwners = () =>(\r\n        <List\r\n        header={<div>流转信息</div>}\r\n        bordered\r\n        dataSource={this.state.owners}\r\n        renderItem={item => (\r\n            <List.Item>\r\n                <Typography.Text mark>[ADDRESS]</Typography.Text> {item}\r\n            </List.Item>\r\n      )}\r\n        />\r\n    );\r\n\r\n    //卖方许可函数\r\n    async approve(){\r\n        let NFT = this.state.NFT;\r\n        console.log(NFT.id);\r\n        try{\r\n            let tx = await contractInstance.methods.sellerApprove(Number(NFT.id )).send({\r\n                from: this.state.address,\r\n                gas: 30000000,\r\n            })\r\n            message.success('卖方确认交易成功');\r\n            this.setstate({\r\n                buttonDisable: true,\r\n            });\r\n            window.location.reload();\r\n        }\r\n        catch(e){\r\n            console.log(e);\r\n            window.location.reload();\r\n        }\r\n    }\r\n\r\n    render(){\r\n        return(\r\n            <div style={{boxShadow: \"2px 2px 1px 2px #888\", margin: \"5px\"}}>\r\n                <PageHeader\r\n                    title= {this.state.NFT.id}\r\n                    tags={<Tag color={this.state.tagColor}>{this.state.NFTState}</Tag>}\r\n                    extra={[\r\n                        <Button key=\"1\" type=\"primary\" disabled={this.state.buttonDisable} onClick={this.approve}>\r\n                            出售许可\r\n                        </Button>\r\n                    ]}>\r\n                </PageHeader>\r\n                <Image width={200} height={200} src={this.state.NFT.uri} />\r\n                <Content>{this.renderContent()}</Content>\r\n                <Content>{this.renderOwners()}</Content>\r\n            </div>\r\n        )\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}