{"ast":null,"code":"import _regeneratorRuntime from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/Users/apple/Documents/openbush/openbush_frontend/node_modules/@babel/runtime/helpers/esm/createSuper\";import{create as ipfsHttpClient}from'ipfs-http-client';import React from'react';import'antd/dist/antd.css';import{Drawer,Form,Button,Space,Input,message,InputNumber,Popconfirm,Image}from'antd';import{PlusOutlined}from'@ant-design/icons';import contractInstance from'../utils/config';import web3 from'../utils/InitWeb3';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var client=ipfsHttpClient('https://ipfs.infura.io:5001/api/v0');var CreateTokenDrawer=/*#__PURE__*/function(_React$Component){_inherits(CreateTokenDrawer,_React$Component);var _super=_createSuper(CreateTokenDrawer);function CreateTokenDrawer(props){var _this;_classCallCheck(this,CreateTokenDrawer);_this=_super.call(this,props);_this.formRef=/*#__PURE__*/React.createRef();_this.showDrawer=function(){_this.setState({visible:true});};_this.onClose=function(){_this.setState({visible:false});};_this.state={fileUrl:'',visible:false};_this.selectFile=_this.selectFile.bind(_assertThisInitialized(_this));_this.NFTCreate=_this.NFTCreate.bind(_assertThisInitialized(_this));return _this;}_createClass(CreateTokenDrawer,[{key:\"selectFile\",value:function(){var _selectFile=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var file,added,url;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:file=e.target.files[0];_context.prev=1;_context.next=4;return client.add(file,{progress:function progress(prog){return console.log(\"received:\".concat(prog));}});case 4:added=_context.sent;url=\"https://ipfs.infura.io/ipfs/\".concat(added.path);this.setState({fileUrl:url});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](1);alert('Error uploading file: ',_context.t0);case 12:case\"end\":return _context.stop();}}},_callee,this,[[1,9]]);}));function selectFile(_x){return _selectFile.apply(this,arguments);}return selectFile;}()},{key:\"NFTCreate\",value:function(){var _NFTCreate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var values,accounts,uri,name,price,description,tx;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:values=this.formRef.current.getFieldValue();console.log(values);_context2.next=4;return web3.eth.getAccounts();case 4:accounts=_context2.sent;uri=this.state.fileUrl;name=values.name;price=web3.utils.toWei(values.price.toString(),\"ether\");console.log(price);console.log(typeof price);description=values.description;console.log(uri,name,price,description);_context2.prev=12;_context2.next=15;return contractInstance.methods.createNFT(uri,name,description,price).send({from:accounts[0],value:web3.utils.toWei('0.00000001','ether'),gas:3000000});case 15:tx=_context2.sent;message.success('收藏品铸造成功');window.location.reload();_context2.next=24;break;case 20:_context2.prev=20;_context2.t0=_context2[\"catch\"](12);console.log(_context2.t0);message.error('收藏品铸造失败');case 24:case\"end\":return _context2.stop();}}},_callee2,this,[[12,20]]);}));function NFTCreate(){return _NFTCreate.apply(this,arguments);}return NFTCreate;}()},{key:\"render\",value:function render(){return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{type:\"primary\",onClick:this.showDrawer,icon:/*#__PURE__*/_jsx(PlusOutlined,{}),children:\"\\u94F8\\u9020\\u65B0\\u7684\\u6536\\u85CF\\u54C1\"}),/*#__PURE__*/_jsx(Drawer,{title:\"Create NFT\",width:720,onClose:this.onClose,visible:this.state.visible,bodyStyle:{paddingBottom:80},children:/*#__PURE__*/_jsxs(Form,{ref:this.formRef,layout:\"vertical\",name:\"nftCreateForm\",initialValues:{modifier:'public'},children:[/*#__PURE__*/_jsx(Form.Item,{name:\"name\",label:\"\\u540D\\u79F0\",rules:[{required:true,message:'请输入收藏品名称'}],children:/*#__PURE__*/_jsx(Input,{placeholder:\"\\u6536\\u85CF\\u54C1\\u540D\\u79F0\"})}),/*#__PURE__*/_jsx(Form.Item,{name:\"price\",label:\"\\u4EF7\\u683C\\uFF08eth\\uFF09\",rules:[{required:true,message:'请输入收藏品价格，单位（eth）'}],children:/*#__PURE__*/_jsx(InputNumber,{min:1,max:1000000,placeholder:\"\\u6536\\u85CF\\u54C1\\u4EF7\\u683C\",style:{width:'200px'}})}),/*#__PURE__*/_jsx(Form.Item,{name:\"description\",label:\"\\u63CF\\u8FF0\",rules:[{required:true,message:'收藏品描述'}],children:/*#__PURE__*/_jsx(Input.TextArea,{rows:4,placeholder:\"\\u6536\\u85CF\\u54C1\\u63CF\\u8FF0\"})}),/*#__PURE__*/_jsxs(Form.Item,{name:\"NFTdata\",label:\"\\u6587\\u4EF6\\u4E0A\\u4F20\",children:[/*#__PURE__*/_jsx(Input,{type:\"file\",name:\"NFT\",className:\"my-4\",onChange:this.selectFile}),this.state.fileUrl&&/*#__PURE__*/_jsx(Image,{width:\"350\",src:this.state.fileUrl})]}),/*#__PURE__*/_jsxs(Space,{direction:\"vertical\",children:[/*#__PURE__*/_jsx(Popconfirm,{title:\"\\u786E\\u5B9A\\u8981\\u63D0\\u4EA4\\u5417?\",okText:\"\\u662F\",cancelText:\"\\u5426\",onConfirm:this.NFTCreate,children:/*#__PURE__*/_jsx(Button,{block:\"true\",type:\"primary\",htmlType:\"submit\",style:{width:'400px'},children:\"\\u63D0\\u4EA4\"})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(Button,{block:\"true\",type:\"primary\",onClick:this.onClose,children:\"\\u53D6\\u6D88\"})]})]})})]});}}]);return CreateTokenDrawer;}(React.Component);export{CreateTokenDrawer as default};","map":{"version":3,"sources":["/Users/apple/Documents/openbush/openbush_frontend/src/Dapp/components/CreateTokenDrawer.js"],"names":["create","ipfsHttpClient","React","Drawer","Form","Button","Space","Input","message","InputNumber","Popconfirm","Image","PlusOutlined","contractInstance","web3","client","CreateTokenDrawer","props","formRef","createRef","showDrawer","setState","visible","onClose","state","fileUrl","selectFile","bind","NFTCreate","e","file","target","files","add","progress","prog","console","log","added","url","path","alert","values","current","getFieldValue","eth","getAccounts","accounts","uri","name","price","utils","toWei","toString","description","methods","createNFT","send","from","value","gas","tx","success","window","location","reload","error","paddingBottom","modifier","required","width","Component"],"mappings":"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","sourcesContent":["import { create as ipfsHttpClient } from 'ipfs-http-client';\r\nimport React from 'react';\r\nimport 'antd/dist/antd.css';\r\nimport { Drawer, Form, Button, Space, Input, message, InputNumber, Popconfirm, Image} from 'antd';\r\nimport { PlusOutlined } from '@ant-design/icons';\r\nimport contractInstance  from '../utils/config';\r\nimport web3 from '../utils/InitWeb3';\r\n\r\nconst client = ipfsHttpClient('https://ipfs.infura.io:5001/api/v0')\r\n\r\nexport default class CreateTokenDrawer extends React.Component{\r\n\r\n    formRef = React.createRef();\r\n\r\n    constructor(props){\r\n        super(props);\r\n\r\n        this.state = {\r\n            fileUrl: '',\r\n            visible: false,\r\n        }\r\n        this.selectFile = this.selectFile.bind(this);\r\n        this.NFTCreate = this.NFTCreate.bind(this);\r\n    }\r\n\r\n  showDrawer = () => {\r\n      this.setState({\r\n        visible: true,\r\n      });\r\n  };\r\n\r\n  onClose = () => {\r\n      this.setState({\r\n        visible: false,\r\n      });\r\n  };\r\n\r\n  async selectFile(e) {\r\n      const file = e.target.files[0];\r\n      try{\r\n          const added = await client.add(\r\n              file,\r\n              {\r\n                  progress: (prog) =>console.log(`received:${prog}`)\r\n              }\r\n          );\r\n          const url = `https://ipfs.infura.io/ipfs/${added.path}`;\r\n          this.setState({\r\n              fileUrl: url,\r\n          });\r\n      }catch (error) {\r\n          alert('Error uploading file: ', error);\r\n      }\r\n  }\r\n\r\n  async NFTCreate(){ \r\n      let values = this.formRef.current.getFieldValue();\r\n      console.log(values);\r\n\r\n      let accounts = await web3.eth.getAccounts();\r\n      let uri = this.state.fileUrl;\r\n      let name = values.name;\r\n      let price = web3.utils.toWei((values.price).toString(), \"ether\");\r\n      console.log(price);\r\n      console.log(typeof(price));\r\n      let description = values.description;\r\n\r\n      console.log(uri,name,price,description);\r\n      try{\r\n        let tx = await contractInstance.methods.createNFT(uri, name, description, price).send({\r\n            from: accounts[0],\r\n            value: web3.utils.toWei('0.00000001', 'ether'),\r\n            gas: 3000000,\r\n        });\r\n        message.success('收藏品铸造成功');\r\n        window.location.reload();\r\n      }\r\n      catch(e){\r\n        console.log(e);\r\n        message.error('收藏品铸造失败');\r\n      }\r\n    \r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <>\r\n        <Button type=\"primary\" onClick={this.showDrawer} icon={<PlusOutlined />}>\r\n            铸造新的收藏品\r\n        </Button>\r\n        <Drawer\r\n          title=\"Create NFT\"\r\n          width={720}\r\n          onClose={this.onClose}\r\n          visible={this.state.visible}\r\n          bodyStyle={{ paddingBottom: 80 }}\r\n\r\n        >\r\n          <Form \r\n              ref={this.formRef}\r\n              layout=\"vertical\"\r\n              name=\"nftCreateForm\" \r\n              initialValues={{modifier: 'public'}}\r\n          >\r\n                <Form.Item\r\n                  name=\"name\"\r\n                  label=\"名称\"\r\n                  rules={[{ required: true, message: '请输入收藏品名称' }]}\r\n                >\r\n                  <Input placeholder=\"收藏品名称\" />\r\n                </Form.Item>\r\n                <Form.Item\r\n                  name=\"price\"\r\n                  label=\"价格（eth）\"\r\n                  rules={[{ required: true, message: '请输入收藏品价格，单位（eth）' }]}\r\n                >\r\n                  <InputNumber min={1} max={1000000} placeholder=\"收藏品价格\" style={{width: '200px'}}/>\r\n                </Form.Item>\r\n                <Form.Item\r\n                  name=\"description\"\r\n                  label=\"描述\"\r\n                  rules={[\r\n                    {\r\n                      required: true,\r\n                      message: '收藏品描述',\r\n                    },\r\n                  ]}\r\n                >\r\n                  <Input.TextArea rows={4} placeholder=\"收藏品描述\" />\r\n                </Form.Item>\r\n                <Form.Item\r\n                  name=\"NFTdata\"\r\n                  label=\"文件上传\"\r\n                >\r\n                    <Input\r\n                        type=\"file\"\r\n                        name=\"NFT\"\r\n                        className=\"my-4\"\r\n                        onChange={this.selectFile}\r\n                    />\r\n                    {\r\n                        this.state.fileUrl && (\r\n                            <Image width=\"350\" src={this.state.fileUrl} />\r\n                        )\r\n                    }\r\n                </Form.Item>\r\n                <Space direction=\"vertical\">\r\n                  <Popconfirm title=\"确定要提交吗?\" okText=\"是\" cancelText=\"否\" onConfirm={this.NFTCreate}>\r\n                    <Button \r\n                        block='true' \r\n                        type='primary' \r\n                        htmlType=\"submit\" \r\n                        style={{width: '400px'}}\r\n                    >\r\n                        提交\r\n                    </Button>\r\n                  </Popconfirm>\r\n                  <br />\r\n                  <Button block='true' type='primary'  onClick={this.onClose}>\r\n                      取消\r\n                  </Button>\r\n                </Space>\r\n            </Form>\r\n        </Drawer>\r\n      </>\r\n    );\r\n  }\r\n}"]},"metadata":{},"sourceType":"module"}